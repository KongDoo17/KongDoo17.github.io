<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Axios</title>
</head>

<body>
    <div id="app">
        <button v-on:click="getData">get user</button>
        <div>
            {{ users }}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        new Vue({
            el: '#app',
            data: {
                users: [],
            },
            methods: {
                getData: function () {
                    var vm = this;

                    this.init();
                },
                init() {
                    this.loadCoords();
                },
                loadCoords() {
                    const loadedCoords = localStorage.getItem("coords");
                    if (loadedCoords === null) {
                        this.askForCoords();
                    } else {
                        const parsedCoords = JSON.parse(loadedCoords);
                        this.getWeather(parsedCoords.latitude, parsedCoords.longitude);
                    }
                },
                askForCoords() {
                    navigator.geolocation.getCurrentPosition(this.handleGeoSucces, this.handleGeoError);
                },
                handleGeoError() {
                    console.log("Cant access geo location");
                },
                handleGeoSucces(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    const coordsObj = {
                        latitude,
                        longitude
                    };
                    this.saveCoords(coordsObj);
                    this.getWeather(latitude, longitude);
                },
                saveCoords(coordsObj) {
                    localStorage.setItem("coords", JSON.stringify(coordsObj));
                },
                getWeather(lat, lon) {
                    /*fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${"d330ecdaa40750cf755f58d071fee78c"}&units=metric`).then(function (response) {
                        return response.json();
                    }).then(function (json) {
                        const weather = document.getElementById("js-weather");
                        const temperature = json.list[0].main.temp;
                        const place = json.city.name;
                        const curwea = json.list[0].weather[0].main;
                
                        weather.innerHTML = "현재 기온 : " + temperature + "℃<br>지역 : " + place + "<br>날씨 : " + curwea;
                        weather.innerHTML += "<img src = 'http://openweathermap.org/img/w/" + json.list[0].weather[0].icon + ".png' id = 'image2'>";
                    });*/
                    var url = "https://api.openweathermap.org/data/2.5/forecast?lat=" + lat + "&lon=" + lon + "&appid=d330ecdaa40750cf755f58d071fee78c&units=metric";

                    axios.get(url)
                        .then(response => {
                            console.log(response.data);
                            console.log(response.data.list[0].weather[0].icon);
                            this.users = response.data;
                        })
                        .catch(function (error) {
                            console.log(error);
                        })
                }
            }
        })
    </script>
</body>

</html>